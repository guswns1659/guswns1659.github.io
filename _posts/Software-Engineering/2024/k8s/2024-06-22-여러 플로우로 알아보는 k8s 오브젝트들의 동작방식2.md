---
title: 여러 플로우로 알아보는 k8s 오브젝트들의 동작방식2
date: 2024-06-16 11:49:08 +09:00
categories: [Software-Engineering]
tags: engineering
---

(TBU)

외부 클라이언트에서 Kubernetes 클러스터 내에서 실행 중인 스프링 애플리케이션 컨테이너로 REST API 요청을 할 때의 플로우를 설명하겠습니다. 이 과정에는 여러 Kubernetes 오브젝트가 관여됩니다.

### 1. 외부 클라이언트 요청

외부 클라이언트는 스프링 애플리케이션의 REST API를 호출합니다. 이 요청은 일반적으로 HTTP/HTTPS 프로토콜을 사용합니다.

### 2. 로드 밸런서 서비스 (LoadBalancer Service)

요청은 먼저 클러스터의 외부 IP 주소로 전달됩니다. 이 IP 주소는 클러스터의 로드 밸런서 서비스에 의해 관리됩니다. 로드 밸런서는 외부 트래픽을 클러스터 내부로 전달합니다.

- **예시**:
  ```yaml
  apiVersion: v1
  kind: Service
  metadata:
    name: my-spring-app
  spec:
    type: LoadBalancer
    selector:
      app: my-spring-app
    ports:
      - protocol: TCP
        port: 80
        targetPort: 8080
  ```

### 3. Ingress 컨트롤러

로드 밸런서 서비스는 트래픽을 Ingress 컨트롤러로 전달합니다. Ingress 컨트롤러는 Ingress 리소스에 정의된 규칙에 따라 트래픽을 적절한 서비스로 라우팅합니다.

- **Ingress 리소스 예시**:
  ```yaml
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: my-ingress
  spec:
    rules:
      - host: myapp.example.com
        http:
          paths:
            - path: /
              pathType: Prefix
              backend:
                service:
                  name: my-spring-app
                  port:
                    number: 80
  ```

### 4. Kubernetes 서비스 (ClusterIP 또는 NodePort)

Ingress 컨트롤러는 요청을 해당 서비스로 전달합니다. 이 서비스는 클러스터 내부에서 실행 중인 Pod으로 트래픽을 라우팅합니다. 일반적으로 ClusterIP 또는 NodePort 타입의 서비스가 사용됩니다.

- **ClusterIP 서비스 예시**:
  ```yaml
  apiVersion: v1
  kind: Service
  metadata:
    name: my-spring-app
  spec:
    selector:
      app: my-spring-app
    ports:
      - protocol: TCP
        port: 80
        targetPort: 8080
  ```

### 5. Kube-Proxy

서비스는 트래픽을 클러스터 내에서 실행 중인 해당 Pod으로 전달합니다. Kube-Proxy는 이 과정을 관리하며, 네트워크 규칙을 설정하여 트래픽이 올바른 Pod으로 전달되도록 합니다.

### 6. Pod 및 컨테이너

최종적으로 트래픽은 해당 Pod에 도달하며, Pod 내의 스프링 애플리케이션 컨테이너가 요청을 처리합니다. 컨테이너는 HTTP 요청을 받아 비즈니스 로직을 수행하고, 응답을 클라이언트에 반환합니다.

### 전체 플로우 요약

1. **외부 클라이언트**: API 요청을 보냄.
2. **로드 밸런서 서비스**: 요청을 클러스터로 전달.
3. **Ingress 컨트롤러**: Ingress 규칙에 따라 요청을 적절한 서비스로 라우팅.
4. **Kubernetes 서비스**: 트래픽을 해당 Pod으로 전달.
5. **Kube-Proxy**: 네트워크 규칙을 관리하여 트래픽 라우팅.
6. **Pod 및 컨테이너**: 요청을 처리하고 응답 반환.

### 참고 자료

- [Kubernetes Ingress Controllers](https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/)
- [Kubernetes Services](https://kubernetes.io/docs/concepts/services-networking/service/)
- [Kubernetes Load Balancing](https://kubernetes.io/docs/concepts/services-networking/load-balancing/)

이 자료들을 통해 Kubernetes에서 외부 클라이언트 요청이 어떻게 내부 애플리케이션 컨테이너로 전달되는지 더 자세히 이해할 수 있습니다.
